---
title: "Satpathy AT et al, 2016 EDA"
author: "Health Data Science Unit"
date: "1/28/2020"
output: 
    html_document:
        code_folding: hide
---

## Sorted CD8 T cells from BCC


```{r setup, include=FALSE}
library(dplyr)
library(ggplot2)

knitr::opts_chunk$set(cache = TRUE, warning = FALSE, message = FALSE)
```

```{r}
## Downloading Satpathy AT et al, 2019 data
barcodes_url <- 'https://www.ncbi.nlm.nih.gov/geo/download/?acc=GSE129785&format=file&file=GSE129785%5FscATAC%2DTME%2DTCells%2Ecell%5Fbarcodes%2Etxt%2Egz'
matrix_url <- 'https://www.ncbi.nlm.nih.gov/geo/download/?acc=GSE129785&format=file&file=GSE129785%5FscATAC%2DTME%2DTCells%2Emtx%2Egz'
peaks_url <- 'https://www.ncbi.nlm.nih.gov/geo/download/?acc=GSE129785&format=file&file=GSE129785%5FscATAC%2DTME%2DTCells%2Epeaks%2Etxt%2Egz'

## dowloading data
if ( ! file.exists('../data/satpathy2016/barcodes.tsv')) {
      download.file(barcodes_url, destfile = '../data/hcv/satpathy2016/barcodes.tsv.gz')
      gunzip('../data/hcv/satpathy2016/barcodes.tsv.gz', 
             destname = '../data/hcv/satpathy2016/barcodes.tsv',
             remove = FALSE)  
}
if ( ! file.exists('../data/satpathy2016/matrix.mtx')){
        download.file(matrix_url, destfile = '../data/satpathy2016/matrix.mtx.gz')
        gunzip('../data/hcv/satpathy2016/matrix.mtx.gz', 
               destname = '../data/hcv/satpathy2016/matrix.mtx', 
               remove = FALSE)  
}
if ( ! file.exists('../data/satpathy2016/genes.tsv')){
        download.file(peaks_url, destfile = '../data/satpathy2016/genes.tsv.gz')
        gunzip('../data/hcv/satpathy2016/genes.tsv.gz', 
               destname = '../data/hcv/satpathy2016/genes.tsv',
               remove = FALSE) 
}
```


```{r loading_data}
## barcodes
barcodes <- read.table('../data/satpathy2016/barcodes.tsv', 
                       header = TRUE)  
barcodes.s <- barcodes$Barcodes

## peaks
peaks <- read.table('../data/satpathy2016/genes.tsv', header = TRUE)
peaks <- as.character(peaks$Feature)

## counts
counts <- readMM('../data/satpathy2016/matrix.mtx')
rownames(counts) <- as.character(peaks)
colnames(counts) <- barcodes.s
```

```{r run_cistopic}
cisTopicObject <- createcisTopicObject(counts[1:100,1:100], project.name='AdBrCortex_accessibility')
cisTopicObject <- addCellMetadata(cisTopicObject, cell.data = barcodes)
```



